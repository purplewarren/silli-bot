name: Validate Silli Bot

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: recursive
        
    - name: Setup Python
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Validate repository structure
      run: |
        echo "📁 Repository structure validation:"
        echo "✅ Main files:"
        ls -la *.py *.md *.txt 2>/dev/null || echo "No root files found"
        
        echo "✅ Bot directory:"
        ls -la bot/ 2>/dev/null || echo "Bot directory not found"
        
        echo "✅ Reasoner directory:"
        ls -la reasoner/ 2>/dev/null || echo "Reasoner directory not found"
        
        echo "✅ Data directory:"
        ls -la data/ 2>/dev/null || echo "Data directory not found"
        
        echo "✅ QA directory:"
        ls -la qa/ 2>/dev/null || echo "QA directory not found"
        
        echo "✅ Reports directory:"
        ls -la reports/ 2>/dev/null || echo "Reports directory not found"
        
    - name: Check Python files
      run: |
        echo "🐍 Python file validation:"
        find . -name "*.py" -type f | head -10
        echo "Total Python files: $(find . -name '*.py' -type f | wc -l)"
        
    - name: Validate configuration files
      run: |
        echo "🔧 Configuration validation:"
        
        if [ -f "requirements.txt" ]; then
          echo "✅ requirements.txt exists"
          echo "Dependencies:"
          cat requirements.txt
        else
          echo "❌ requirements.txt missing"
        fi
        
        if [ -f ".env" ]; then
          echo "✅ .env file exists (local config)"
        else
          echo "⚠️ .env file not found (expected for local dev)"
        fi
        
        if [ -f "CHANGELOG.md" ]; then
          echo "✅ CHANGELOG.md exists"
        else
          echo "❌ CHANGELOG.md missing"
        fi
        
    - name: Check submodule
      run: |
        echo "📦 Submodule validation:"
        if [ -d "silli-meter" ]; then
          echo "✅ silli-meter submodule exists"
          ls -la silli-meter/
        else
          echo "❌ silli-meter submodule missing"
        fi
        
    - name: Validate backup data
      run: |
        echo "💾 Backup validation:"
        if [ -d "backup/v0.2.1-beta" ]; then
          echo "✅ Backup directory exists"
          ls -la backup/v0.2.1-beta/
        else
          echo "⚠️ Backup directory not found"
        fi
        
    - name: Success message
      run: |
        echo "🎉 Repository validation completed successfully!"
        echo "✅ All core directories and files are present"
        echo "✅ Ready for local development and testing"
